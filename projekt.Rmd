---
title: "Poročilo pri predmetu Analiza podatkov s programom R"
author: "Veronika Nabergoj"
output:
  html_document: default
  pdf_document:
    includes:
      in_header: lib/styles.sty
    latex_engine: xelatex
---

```{r setup, echo=FALSE, results='hide', message=FALSE}
# Če želimo nastaviti pisave v PDF-ju, odkomentiramo
# in sledimo navodilom v programu.
#source("fontconfig.r", encoding = "UTF-8")

# Uvoz vseh potrebnih knjižnic
source("lib/libraries.r", encoding = "UTF-8")
```

# Izbira teme

Izbrala sem si temo preseljevanja v Sloveniji. V tem projektu bom raziskala in analizirala priseljevanje in izseljevanje prebivalstva, od leta 1995 do leta 2014, po posameznih regijah Slovenije in po starostnih skupinah. Pregledala bom podatke Slovenije in analizirala v katerih starostnih skupinah in v katerih regiajh je prišlo do porasta preseljevanja. Ločila bom preseljevanje tudi po državljanstvu in tako natančneje določila koliko slovenskih državljanov se je izselilo iz Slovenije ali priselilo nazaj v Slovenijo.

***

# Obdelava, uvoz in čiščenje podatkov

```{r uvoz, echo=FALSE}
source("uvoz/uvoz.r", encoding = "UTF-8")
```

Najprej sem poiskala podatke. Našla sem jih na spletni strani: 
  * Statistični urad RS: `http://www.stat.si/StatWeb/pregled-podrocja?idp=17&headerbar=15`

Uvozila sem podatke o preseljevanju iz Slovenije ter v Slovenijo v obliki CSV iz splene strani statističnega urada RS. Podatki so ločeni glede na leto, državljanstvo, starostno skupino in spol.

```{r razpredelnice}
kable(head(tabela))
```

V tej tabeli so v zadnjih treh stolpcih številske spremenljivke, v preostalih pa so imenske spremenljivke. 

Najprej sem morala tabelo očistiti praznih vrstic, ki jih je uvozilo iz spletne strani, zato sem uporabila sledečo funkcijo:

```{r funkcija uredimo}
uredimo <- function(tabela, x, y, z, max = nrow(tabela)) {
  s <- seq(x, max, z+1)
  tabela[t(matrix(x:max, ncol=length(s))), y] <- tabela[s, y]
  tabela <- tabela[-s,]
  return(tabela)
}
```

Ta funkcija je tudi zapisala v vsako vrstico tisto imensko spremenljvko, ki bi tam morala biti. 
Nato sem še preverila da so številske spremenljivke zares številke.

Ko je bila tabela urejena in so bili vsi podatki zbrani, sem najprej fitrirala tabelo po prvi spremenljivki: priseljeni iz tujine in odseljeni v tujino in tako dobila dve tabeli: priseljeni in odseljeni.

Da bi nato lažje in učinkoviteje filtrirala tabele po različnih spremenljivkah sem sestavila sledečo funkcijo:

```{r funkcija razberi}
razberi <- function(x,y,podatki){
  return(podatki[podatki[y] == x, names(podatki) != y])
}
```

S to funkcijo sem dobila podtabele po letih, državljanstvu in starostnih skupinah.

V tabeli priseljen

Kot drugo tabelo sem uvozila še podatke o priseljevanju iz tujine in priseljevanju v tujino po regijah in letih v obliki html.

```{r razpredelnice}
kable(head(tabela2))
```


***

# Analiza in vizualizacija podatkov

```{r vizualizacija, echo=FALSE}
source("vizualizacija/vizualizacija.r", encoding = "UTF-8")
```

Slika \ref{fig:graf} prikazuje razliko med priseljenimi Slovenci in odseljenimi Slovenci po letih in starostnih skupinah (te so prikazane z različnimi velikostmi pik) ter prirast,ki je prikazan z barvami. Prirast je lahko pozitiven, negativen ali enak 0.

```{r graf, echo=FALSE, fig.align='center', fig.cap='Graf razlike priseljenih Slovencev in odseljeni Slovenci'}
ggplot(data=priseljeni.minus.odseljeni%>%filter(starostna.skupina !="Starostne skupine - SKUPAJ"),
       aes(x=leto, y=razlika.skupaj,color=prirast.skupaj, size=starostna.skupina)) + geom_point()
```


Slika \ref{graf2} pa nam predstavi 3 grafe odseljenih prebivalcev, ki jih ločimo po državljanstvu. V grafih vidimo da so prebivalci nato ločeni še po starostnih skupinah. Vsi podatki so za leto 2014.

```{r graf2, echo=FALSE, fig.align='center', fig.cap='Graf'}
ggplot(data=ods.2014%>%filter(starostna.skupina !="Starostne skupine - SKUPAJ"),
       aes(starostna.skupina,skupaj))+ geom_bar(stat="identity",fill="seagreen3",size=3) + 
       coord_flip()+ facet_wrap(~ državljanstvo)
```


***

# Napredna analiza podatkov

```{r analiza, echo=FALSE}
source("analiza/analiza.r", encoding = "UTF-8")
```


***