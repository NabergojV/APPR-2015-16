---
title: "Poročilo pri predmetu Analiza podatkov s programom R"
author: "Veronika Nabergoj"
output:
  pdf_document:
    includes:
      in_header: lib/styles.sty
    latex_engine: xelatex
  html_document: default
---

```{r setup, echo=FALSE, results='hide', message=FALSE,warning=FALSE}
# Če želimo nastaviti pisave v PDF-ju, odkomentiramo
# in sledimo navodilom v programu.
#source("fontconfig.r", encoding = "UTF-8")

# Uvoz vseh potrebnih knjižnic
source("lib/libraries.r", encoding = "UTF-8")
```

# Izbira teme

Izbrala sem si temo preseljevanja v Sloveniji. V tem projektu bom raziskala in analizirala priseljevanje in izseljevanje prebivalstva, od leta 1995 do leta 2014, po posameznih regijah Slovenije in po starostnih skupinah. Pregledala bom podatke Slovenije in analizirala v katerih starostnih skupinah in v katerih regiajh je prišlo do porasta preseljevanja. Ločila bom preseljevanje tudi po državljanstvu in tako natančneje določila koliko slovenskih državljanov se je izselilo iz Slovenije ali priselilo nazaj v Slovenijo.

***

# Obdelava, uvoz in čiščenje podatkov

```{r uvoz, echo=FALSE}
source("uvoz/uvoz.r", encoding = "UTF-8")
```

Najprej sem poiskala podatke. Našla sem jih na spletni strani: 
+Statistični urad RS: `http://www.stat.si/StatWeb/pregled-podrocja?idp=17&headerbar=15`


###Tabela 1

Uvozila sem podatke o preseljevanju iz Slovenije ter v Slovenijo v obliki CSV iz splene strani statističnega urada RS. Podatki so ločeni glede na leto, državljanstvo, starostno skupino in spol.

```{r tabela 1}
kable(head(tabela))
```

V tej tabeli so v zadnjem, šestem stolpcu številske spremenljivke, v preostalih pa so imenske spremenljivke. 

Najprej sem morala tabelo očistiti praznih vrstic, ki jih je uvozilo iz spletne strani, zato sem uporabila sledečo funkcijo:

#####Funkcija za urejanje tabel:
```{r uredimo}
uredimo <- function(tabela, x, y, z, max = nrow(tabela)) {
  s <- seq(x, max, z+1)
  tabela[t(matrix(x:max, ncol=length(s))), y] <- tabela[s, y]
  tabela <- tabela[-s,]
  return(tabela)
}
```

Ta funkcija je tudi zapisala v vsako vrstico tisto imensko spremenljvko, ki bi tam morala biti. 
Nato sem še preverila da so številske spremenljivke zares številke.

Ko je bila tabela urejena in so bili vsi podatki zbrani, sem najprej fitrirala tabelo po prvi spremenljivki: priseljeni iz tujine in odseljeni v tujino in tako dobila dve tabeli: priseljeni in odseljeni.

<<<<<<< HEAD
```{r razpredelnice}
kable(head(druzine))
=======
Da bi nato lažje in učinkoviteje filtrirala tabele po različnih spremenljivkah sem sestavila sledečo funkcijo _razberi_:

#####Funkcija za filtriranje podatkov iz tabel
```{r razberi}
razberi <- function(x,y,podatki){
  return(podatki[podatki[y] == x, names(podatki) != y])
}
>>>>>>> fa0d273194fc37e57a0cc5ffaef2e306dfa06c64
```

S to funkcijo sem dobila podtabele po letih, državljanstvu in starostnih skupinah.

###Tabela 2

Kot drugo tabelo sem uvozila še podatke o priseljevanju iz tujine in priseljevanju v tujino po regijah in letih v obliki html.

```{r tabela 2}
kable(head(tabela2))
```

Tudi tu sem morala najprej prečistiti podatke, izbrisati določene vrstice in nato s funkcijo _uredimo_ pretvorila v želene tabele. 

***

# Analiza in vizualizacija podatkov

####Graf razlike priseljenih Slovencev in odseljenih Slovencev

Slika \ref{fig:graf} prikazuje razliko med priseljenimi Slovenci in odseljenimi Slovenci po letih in starostnih skupinah (te so prikazane z različnimi velikostmi pik) ter prirast, ki je prikazan očitno, saj je lahko pozitiven, negativen ali enak 0.

```{r graf, echo=FALSE, fig.align='center', fig.cap='Graf razlike priseljenih Slovencev in odseljenih Slovencev'}
ggplot(data=priseljeni.minus.odseljeni%>%filter(starostna.skupina !="Starostne skupine - SKUPAJ"),
       aes(x=leto, y=razlika,color=starostna.skupina)) + geom_point(size=6) +
       coord_flip() 
```
 
Iz grafa je razvidno da je največji negativen prirast postajal vedno bolj negativen in je 2014 tudi dosegel največjo stopnjo izseljevanja. Če pogledamo še starostne skupine, padejo v kategorijo **25-29 let** in kategorijo **30-35 let**. 

####Graf odseljenih prebivalcev ločenih po državljanstvu za leto 2014

Slika \ref{fig:graf2} nam predstavi 3 grafe odseljenih prebivalcev, ki jih ločimo po državljanstvu. V grafih vidimo da so prebivalci nato ločeni še po starostnih skupinah. Vsi podatki so za leto 2014.

```{r graf2, echo=FALSE, fig.align='center', fig.cap='Graf odseljenih prebivalcev ločenih po državljanstvu za leto 2014'}
ggplot(data=ods.2014%>%filter(starostna.skupina !="Starostne skupine - SKUPAJ"),
       aes(starostna.skupina,skupaj))+ geom_bar(stat="identity",fill="seagreen3",size=3) + 
       coord_flip()+ facet_wrap(~ državljanstvo)
```

####Graf za odseljene prebivalce po starostnih skupinah skupaj in državljanstvu skupaj

Tu \ref{fig:graf3} vidimo je bilo odseljevanje najmočnejše leta 2009.

```{r graf3, echo=FALSE, fig.align='center', fig.cap='Graf za odseljene prebivalce po starostnih skupinah skupaj, državljanstvu skupaj in spolu'}
ggplot(data=odseljeni4,
       aes(leto,stevilka,fill=spol))+ geom_bar(stat="identity",size=6) + coord_flip()
```

####Graf za priseljene skupaj za vse regije za leto 2014

Na sliki \ref{fig:graf4} je opaziti da je največ priseljenih v Osrednjeslovensko regijo. Razlog za to je najverjetneje v največji ponudbi služb in možosti za šolanje, kariero, družine,...

```{r graf4, echo=FALSE, fig.align='center', fig.cap='Graf za priseljene skupaj za vse regije za leto 2014'}
ggplot(data=regije2014,
       aes(regija,Priseljeni.iz.tujine.skupaj))+ geom_bar(stat="identity",fill="deeppink3",size=10)+
       coord_flip() 
```


####Graf za odseljene v tujino za Goriško regijo po letih:

Ta slika \ref{fig:graf5} nam predstavi odseljene prebivalce Goriške regije v letih od 1995-2014. Razvidno je bilo leta 2009 največje odseljevanje. V _Grafu za odseljene prebivalce po starostnih skupinah skupaj in državljanstvu skupaj_ smo prav tako omenili, da je bilo preseljevanje najmočnejše let 2009.

```{r graf5, echo=FALSE, fig.align='center', fig.cap='Graf za odseljene v tujino za Goriško regijo po letih'}
ggplot(data=Goriska,
       aes(x=leto, y=Odseljeni.v.tujino.skupaj,alpha=Odseljeni.v.tujino.na.1000.prebivalcev)) + 
       geom_point(size=10,color="firebrick3")
```
