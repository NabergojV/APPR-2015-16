---
title: "Poročilo pri predmetu Analiza podatkov s programom R"
author: "Veronika Nabergoj"
output:
  html_document: default
  pdf_document:
    includes:
      in_header: lib/styles.sty
    latex_engine: xelatex
runtime: shiny
---

```{r setup, echo=FALSE, results='hide', message=FALSE,warning=FALSE}
# Če želimo nastaviti pisave v PDF-ju, odkomentiramo
# in sledimo navodilom v programu.
#source("fontconfig.r", encoding = "UTF-8")

# Uvoz vseh potrebnih knjižnic
source("lib/libraries.r", encoding = "UTF-8")
```

# Izbira teme

Izbrala sem si temo preseljevanja v Sloveniji. V tem projektu bom raziskala in analizirala priseljevanje in izseljevanje prebivalstva, od leta 1995 do leta 2014, po posameznih regijah Slovenije in po starostnih skupinah. Pregledala bom podatke Slovenije in analizirala v katerih starostnih skupinah in v katerih regiajh je prišlo do porasta preseljevanja. Ločila bom preseljevanje tudi po državljanstvu in tako natančneje določila koliko slovenskih državljanov se je izselilo iz Slovenije ali priselilo nazaj v Slovenijo.

***

# Obdelava, uvoz in čiščenje podatkov

```{r uvoz, echo=FALSE}
source("uvoz/uvoz.r", encoding = "UTF-8")
```

Najprej sem poiskala podatke. Našla sem jih na spletni strani: 

* Statistični urad RS: `http://www.stat.si/StatWeb/pregled-podrocja?idp=17&headerbar=15`


### Tabela 1

Uvozila sem podatke o preseljevanju iz Slovenije ter v Slovenijo v obliki CSV iz splene strani statističnega urada RS. Podatki so ločeni glede na leto, državljanstvo, starostno skupino in spol.

```{r tabela1, echo=FALSE}
kable(head(tabela))
```

V tej tabeli so v zadnjem, šestem stolpcu številske spremenljivke, v preostalih pa so imenske spremenljivke. 

Najprej sem morala tabelo očistiti praznih vrstic, ki jih je uvozilo iz spletne strani, zato sem uporabila sledečo funkcijo:

##### Funkcija za urejanje tabel:
```{r uredimo}
uredimo <- function(tabela, x, y, z, max = nrow(tabela)) {
  s <- seq(x, max, z+1)
  tabela[t(matrix(x:max, ncol=length(s))), y] <- tabela[s, y]
  tabela <- tabela[-s,]
  return(tabela)
}
```

Ta funkcija je tudi zapisala v vsako vrstico tisto imensko spremenljvko, ki bi tam morala biti. 
Nato sem še preverila da so številske spremenljivke zares številke.

Ko je bila tabela urejena in so bili vsi podatki zbrani, sem najprej fitrirala tabelo po prvi spremenljivki: priseljeni iz tujine in odseljeni v tujino in tako dobila dve tabeli: priseljeni in odseljeni.

Da bi nato lažje in učinkoviteje filtrirala tabele po različnih spremenljivkah sem sestavila sledečo funkcijo _razberi_:

##### Funkcija za filtriranje podatkov iz tabel
```{r razberi}
razberi <- function(x,y,podatki){
  return(podatki[podatki[y] == x, names(podatki) != y])
}
```

S to funkcijo sem dobila podtabele po letih, državljanstvu in starostnih skupinah.

### Tabela 1 v tidy data obliki

Tabelo 1 sem pretvorila v tidy data obliko tako, da sem odstranila stolpce skupaj, ki so mi bili v pomoč pri risanju grafov. Dodala sem ji tudi stolpec, v katerem je urejenostna spremenljivka, ki prikaže prirast ljudi (odštejemo odseljene od priseljenih).

```{r tabela1tidy, echo=FALSE}
kable(head(tidytabela1))
```

#### Spremenljivke:

Stolpci v tabeli 1:

* priseljeni.ali.odseljeni: _imenska spremenljivka_
* leto: _številska spremenljivka_
* starostna.skupina: _imenska spremenljivka_
* drzavljanstvo: _imenska spremenljivka_
* spol: _imenska spremenljivka_
* stevilka: _številska spremenljivka_
* prise.min.odse.prirast: _urejenostna spremenljivka_

### Tabela 2

Kot drugo tabelo sem uvozila še podatke o priseljevanju iz tujine in priseljevanju v tujino po regijah in letih v obliki html.

```{r tabela2, echo=FALSE}
kable(head(tabela2))
```

Tudi tu sem morala najprej prečistiti podatke, izbrisati določene vrstice in nato s funkcijo _uredimo_ pretvorila v želene tabele. 

### Tabela 2 v tidy data obliki

```{r tabela2tidy, echo=FALSE}
kable(head(tidytabela2))
```

#### Spremenljivke:

Stolpci v tabeli 2 imajo sledeče značilnosti:

* regija: _imenska spremenljivka_
* leto: _številska spremenljivka_
* Priseljeni.iz.tujine.moški: _številska spremenljivka_
* Priseljeni.iz.tujine.ženske: _številska spremenljivka_
* Odseljeni.v.tujino.moški: _številska spremenljivka_
* Odseljeni.v.tujino.ženske: _številska spremenljivka_
* Priseljeni.iz.tujine.na.1000.prebivalcev: _številska spremenljivka_
* Odseljeni.v.tujino.na.1000.prebivalcev: _številska spremenljivka_

***

### Graf razlike priseljenih Slovencev in odseljenih Slovencev

Slika \ref{fig:graf} prikazuje razliko med priseljenimi Slovenci in odseljenimi Slovenci po letih in starostnih skupinah (te so prikazane z različnimi barvami) ter prirast, ki je očiten, saj je lahko pozitiven, negativen ali enak 0.

```{r graf, echo=FALSE, fig.align='center', fig.cap='Graf razlike priseljenih Slovencev in odseljenih Slovencev'}
ggplot(data=prise.min.odse%>%filter(starostna.skupina !="Starostne skupine - SKUPAJ"),
       aes(x=leto, y=razlika,color=starostna.skupina)) + geom_point(size=3) +
       coord_flip() 
```
 
Iz grafa je razvidno da je največji negativen prirast postajal vedno bolj negativen in je 2014 tudi dosegel največjo stopnjo izseljevanja. Če pogledamo še starostne skupine, padejo v kategorijo **25-29 let** in kategorijo **30-35 let**, to pa so najbolj produktivna leta in najbolj izobražena populacija. To je poimenovano _beg možganov._

### Graf odseljenih ali priseljenih prebivalcev ločenih po državljanstvu za izbrano leto

_V teh treh grafih, ki so ločeni po državljanstvu, so prikazani podatki za izbrano leto. Tako lahko primerjamo priseljevanje in izseljevanje. Stolpci so obarvani glede na spol. Z animacijo pa takoj vidimo katera starostna skupina je najbolj aktivna pri priseljevanju ali izseljevanju._

```{r shiny2, echo=FALSE, fig.align='center', fig.cap='Graf odseljenih ali priseljenih prebivalcev ločenih po državljanstvu za izbrano leto'}
shinyAppDir("shiny2", options=list(width="100%", height="590"))
```

_Priseljevanje:_ Očitno je, da je priseljevanje slovenskih državljanov nazaj v Slovenijo skoraj neznatno v primerjavi s priseljevanjem tujih državljanov. Bolj znatno postane leta 2011 in je prisotno do leta 2014.

_Odseljevanje:_ Slovenski državljani so se odseljevali zelo malo z izjemo leta 2002, ko je odseljevanje rahlo naraslo. Leta 2008 je odseljevanje močno naraslo, najverjetneje zaradi bližajoče se krize, upadlo 2009, kasneje v letih 2012, 2013, 2014 pa opazno poskočilo.

### Graf za izbrano starostno skupino obarvan po spolu ali po državljanstvu:

```{r shiny5, echo=FALSE, fig.align='center', warning=FALSE, fig.cap='Graf za izbrano starostno skupino obarvan po spolu ali po državljanstvu'}
shinyAppDir("shiny5", options=list(width="100%", height=510))
```

### Graf vseh regij za priseljene ali odseljene za izbrano leto:

_Ta graf nam simultano prikazuje potek priseljevanja in odseljevanja za vse regije. Izbiramo lahko med kategorijami ki so ločene po spolu._

```{r shiny, echo=FALSE, fig.align='center', warning=FALSE, fig.cap='Graf za priseljene ali odseljene za izbrano leto'}
shinyAppDir("shiny", options=list(width="100%", height=510))
```

_Odseljevanje:_ Očitno je odseljevanje najmočnejše v osrednjeslovenski regiji skozi vsa leta. Regiji ki izstopata sta še podravska in savinjska 1995 pa je odseljevanje v podravski regiji posledica osamosvojitve Slovenije, ko je v Mariboru propadla velika večina podjetij. Odseljevanje iz podravske regije skokoma naraste še leta 2008 in celo preseže odseljevanje iz osrednjeslovenske regije.

_Priseljevanje:_ Tukaj je prav tako najmočnejše v osrednjeslovenski regiji, zaradi največje in najbolj raznolike ponudbe zaposlitve.

Najboljšo sliko glede priseljevanja dobimo če si pogledamo prirast. Tako je očitno da je v osrednjeslovenski regiji le ta pozitiven skozi vsa leta, v Podravski regiji pa je negativen od leta 2010 - 2014 z izjemo leta 2011. Nasplošno rečeno imajo SV regije od časa finančne krize naprej negativen prirast, prav tako pa tudi nekatere severne.

### Graf za odseljene ali priseljene za izbrano regijo po letih:

_V tem grafu si lahko za poljubno regijo ogledamo kako je potekalo priseljevanje in odseljevanje ločeno po spolu._

```{r graf5, echo=FALSE, fig.align='center', fig.cap='Graf za odseljene ali priseljene za izbrano regijo po letih'}
shinyAppDir("shiny4", options=list(width="100%", height=465))
```

Podrobneje bom pogledala regijo v kateri živim, ter osrednjeslovensko.

_Osrednjeslovenska regija:_ Kot je bilo navedeno pri prejšnjem grafu je prirast tekom let pozitiven, z izjemo leta 1998 in 2010. Vrhunec pa je prirast dosegel leta 2008, potem pa z letom 2010 strmo upadel.

_Goriška regija:_ Vidimo da je prirast konstantno pozitiven, razen leta 1998.

Ta slika nam predstavi odseljene prebivalce Goriške regije v letih od 1995-2014. Razvidno je bilo leta 2009 največje odseljevanje.

***

# Analiza in vizualizacija podatkov

```{r ainv, echo=FALSE, results='hide', message=FALSE, warning=FALSE}
source("vizualizacija/vizualizacija.r", encoding = "UTF-8")
```


### Zemljevid regij Slovenije obarvan glede na izbrano kategorijo in v izbranem letu:

_Na tem zemljevidu vidimo priseljevanje ali odseljevanje v slovenskih regijah od leta 1995 do leta 2014._

```{r shiny3, echo=FALSE, fig.align='center', warning=FALSE, fig.cap='Zemljevid regij Slovenije obarvan glede na izbrano kategorijo in v izbranem letu:'}
shinyAppDir("shiny3", options=list(width="100%", height=505))
```


***

# Napredna analiza

```{r napanaliza, echo=FALSE, results='hide', message=FALSE, warning=FALSE}
source("analiza/analiza.r", encoding = "UTF-8")
```